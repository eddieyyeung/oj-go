## 题目

给定四个整数 $A$, $B$, $C$ 和 $D$，满足 $A \le B \le C \le D$，求：

有多少组 $x$, $y$, $z$, 可以构成三角形，并且满足 $A \le x \le B \le y \le C \le z \le D$

其中， $1 \le A \le B \le C \le D \le 5*10^5$

## 分析

由于题目的数值范围在 1e6，那么肯定是需要用到 $O(n)$ 的算法复杂度。

---

首先，三角形的构成需要满足：任意两条边的和肯定是大于第三条边。由于 $x \le y \le z$，那么只要满足 $x + y > z$ 就可以构造三角形。

我们可以令 $s = x + y$，统计所有等于 $s$ 的 $(x,y)$ 组合的个数 $cnt_s$，那么对于所有 $z < s$ 的情况，都会有 $cnt_s$ 种组合可以构成三角形。比如，假设 $s=4$ 对应的 $(x,y)$ 的组合有 2 种，那么当 $z=3$ 时，可以有 2 种组合构成三角形，同理 $z=2,1$ 时也是一样的。

---
那么现在的问题就转换成如何统计 $s$ 出现的个数。令 $x=i$，则 $x+y$ 的区间范围为 $[i+B, i+C]$，在这个区间内对每个 $s$ 出现的个数进行 +1，从而统计出每个 $s$ 出现的组合个数 $cnt_s$。

然后，对于每个 $z ($z < s$)，都有 $cnt_s$ 种组合满足条件。可以从后往前遍历 $s$ ($s \in [A+B, B+C]$)，通过后缀和计算出组合的结果。这里其实只要遍历 $[C, B+C]$ 就足够了，因为 $z$ 的取值范围是 $[C,D]$。

最后，遍历 $z$ ($z \in [C,D]$)，累加每一个小于 s 的组合个数 $sum[z_i+1]$，求得最终答案。

> 其中还有个问题，如何快速计算出每个 $s$ 出现的组合个数呢？

如果按照常规的做法，就是遍历 x，然后再遍历 y 逐个计算，那么时间复杂度会是 $O(n^2)$，所以不能按照这种做法实现。

我们知道，对于 $x = i$， $x + y$ 的区间范围为 $[i+B, i+C]$，假设数组 $sum$ 表示 $s$ 出现的组合个数，我们不妨把 $sum[i+B]$ 个数 +1 和 $sum[i+C+1]$ 个数 -1，然后再执行一遍前缀和，就可以得到结果。以这种方式实现的时间复杂度是 $O(A) + O(C-A) = O(n)$

---

时间复杂度 $O(n)$

空间复杂度 $O(n)$
